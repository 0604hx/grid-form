import{aH as me,aP as fe,aQ as _e,aI as we,aR as De,aS as Me,Z as se,aE as Se,aD as ge,aF as J,aj as ye,aw as ke,aJ as Ce,am as Oe,ax as Ae,aM as Ne}from"./index.NKemXjiB.js";import{r as Ee,h as de,o as Fe,ak as le,S as g,y as Pe,w as Te,b as be,_ as Le,a1 as Re,E as v,G as R,R as X,F as B,a2 as ie,H as je,a4 as G,K as C,c as U,I as Q,J as L,L as ee,a6 as Z,aa as $e,ag as Ge,l as Ye}from"./framework.040mz0Gi.js";import{p as ze,q as Ue}from"./theme.rqsHfMZW.js";const pe="post",Ve={renders:{type:Object},form:{type:Object},gridGap:{type:Number,default:10},debug:{type:Boolean,default:!1},review:{type:Boolean,default:!0},placeholder:{type:String,default:"^\\${(.*)}$"},valueProvider:{type:Object,default:fe},lockLabelPlacement:{type:String}},He=["submit","failed","inited"],Ie=(s,N,O="")=>{let E=Ee(!1);const $=de({_disabled:!1}),p={},a=new Set,w=o=>{if(typeof o=="object"){let c={};return Object.keys(o).forEach(i=>c[i]=le(g(o[i]))),c}else if(Array.isArray(o))return o.map(c=>le(g(c)));return le(g(o))},m=(...o)=>console.debug(`%c[RENDER${O}]`,"background:#8c0776;padding:3px;color:white",...o),h=o=>{if(s.review){let c=[];if(Object.keys(p).forEach(i=>{let{regex:D,msg:H,label:j}=p[i];o[i]?D&&!RegExp(D).test(o[i])&&c.push(H||`${j}（${i}）校验未通过`):c.push(`${j}（${i}）未填写`)}),c.length)return s.debug&&m("[表单检查]",c),N("failed",c)}return!0},M=(o,c=pe)=>{delete o._disabled,h(o)===!0&&N("submit",o,c)},f=()=>{let{onSubmit:o}=s.form,c=w($);if(o&&typeof(o==="string")){if(h(c)!=!0)return;_e(o,$,w(s.form.items)).then(i=>{s.debug&&m("<onSubmit> 回调函数返回（仅当返回布尔 true 方能继续提交表单）",i),i===!0?N("submit",w($),pe):s.debug&&m("<onSubmit> 回调函数返回非 true ，中断表单提交")})}else M(c)},V=async(o,c)=>{if(RegExp(s.placeholder).test(o)&&o in s.valueProvider){let i=await s.valueProvider[o]();return s.debug&&m(`[表单值计算 #${c}]`,o," > ",i),i}return o},F=()=>{let{onChange:o}=s.form;if(a.size&&!o)return s.debug&&m(`<onChange> 尝试监听 ${a.size} 个表单项变动事件，但未定义 onChange 回调代码...`);if(a.size==0&&o)return s.debug&&m("<onChange> 已定义 onChange 回调代码，但未对任何表单项设置监听选项...");a.size&&o&&a.forEach(c=>{Te(()=>$[c],(i,D)=>{s.debug&&m(`<onChange> 触发表单项 ${c} 变动：${D} > ${i}`),Me(s.form.onChange,$,{key:c,from:D,to:i},s.form.items)})})},Y=async(o,c)=>{if(Array.isArray(o))for(const i of o){if(i._uuid){let D=await V(i._value,i._uuid);i._widget==="SWITCH"&&typeof D!="boolean"?D=typeof D=="string"?D.toLowerCase()=="true":typeof D=="number"?D!=0:!!D:(i._widget==="RATE"||i._widget==="NUMBER")&&!isNaN(D)&&(D=Number(D)),c[i._uuid]=D,i._required===!0&&(p[i._uuid]={regex:i._regex,msg:i._message,label:i._text}),i._watch===!0&&a.add(i._uuid)}i._container===!0&&(i.category=i.category||"simple",i.category=="single"?c[i._uuid]={}:i.category=="multiple"&&(c[i._uuid]=[]),await Y(i.items,i.category=="simple"?c:c[i._uuid]))}},te=async()=>{let{items:o,hides:c}=s.form;if(Array.isArray(c))for(let i of c)i.id&&($[i.id]=await V(i.value,i.id));s.debug&&m("开始计算表单值",$),await Y(o,$),s.debug&&m("完成计算表单值",$),F(),we(o),Pe(()=>{s.form.onLoad&&(s.debug&&m("<onLoad> 触发表单初始化事件"),me(s.form.onLoad,$,s.form.items)),E.value=!0,N("inited")})},oe=o=>{let c=De(o.code,$);if(o.type!="script"){if(c!==!0){s.debug&&m(`<自定义按钮点击> 返回 ${c} 故中断后续的动作`);return}M(w($),o.type)}};return s.renders&&(s.renders.runScript=o=>{let c=typeof o=="string"?o:o.script;s.debug&&m("执行组件脚本：",c),c&&me(c,$,s.form.items)}),Fe(te),{_raw:w,track:m,inited:E,formData:$,formRequired:p,toSubmit:f,onExtraBtn:oe}},We={renders:{type:Object},form:{type:Object},gridGap:{type:Number,default:10},formData:{type:Object},lockLabelPlacement:{type:String}},Be=s=>{const N=be(()=>s.form._container===!0&&s.form.category==="multiple"),O=be(()=>{if(!N.value)return!1;let{max:p}=s.form;return isNaN(p)||p==0||s.formData.length<p});return{isMultiple:N,canAdd:O,childForm:p=>!p.category||p.category=="simple"?s.formData:s.formData[p._uuid],onAddRow:()=>{if(!N)throw Error("暂不支持添加新数据行");const p=Object.keys(s.formData).slice(s.formData.length);let a={};p.forEach(w=>a[w]=s.formData[w]),s.formData.push(a)}}},qe={class:"gf-render-table"},Je={width:"40",class:"c"},Ze={key:0,style:{color:"red"}},Qe={style:{"margin-top":"10px","text-align":"center"}},xe={key:0,style:{color:"red"}},Ke={name:"render-container",inheritAttrs:!1},Xe=Object.assign(Ke,{props:We,setup(s){const N=s,{isMultiple:O,canAdd:E,childForm:$,onAddRow:p}=Be(N);return(a,w)=>{const m=Re("render-container");return g(O)?(v(),R(B,{key:0},[X("table",qe,[(v(!0),R(B,null,ie(a.formData,(h,M)=>(v(),R("tr",{class:je({striped:M%2==1})},[X("td",Je,[G(g(Se),{"negative-text":null,onPositiveClick:f=>a.formData.splice(M,1)},{trigger:C(()=>[G(g(se),{size:"small",type:"primary",tertiary:"",circle:""},{default:C(()=>[U(Q(M+1),1)]),_:2},1024)]),default:C(()=>[U(" 删除第"+Q(M+1)+"行数据？ ",1)]),_:2},1032,["onPositiveClick"])]),X("td",null,[G(g(ye),{"x-gap":a.gridGap,"y-gap":a.gridGap,cols:a.form.grid,style:$e({width:a.form.width,margin:"0px auto"})},{default:C(()=>[(v(!0),R(B,null,ie(a.form.items,(f,V)=>(v(),R(B,{key:V},[f._hide!=!0?(v(),L(g(ge),{key:0,span:f._col,"show-feedback":!1,"show-label":!(f._hideLabel===!0||!a.form.labelShow),"label-placement":a.form.labelPlacement,"label-align":a.form.labelAlign,"label-width":a.form.labelWidth},{label:C(()=>[U(Q(f._text),1),f._required?(v(),R("span",Ze," *")):ee("",!0)]),default:C(()=>[f._container&&f.items?(v(),L(Z(g(J)(f,a.renders,!1)),{key:0},{default:C(()=>[G(m,{gridGap:a.gridGap,renders:a.renders,form:f,formData:g($)(f),labelPlacement:f.labelPlacement,labelAlign:f.labelAlign},null,8,["gridGap","renders","form","formData","labelPlacement","labelAlign"])]),_:2},1024)):f._widget=="DATE"?(v(),L(Z(g(J)(f,a.renders,!1)),{key:1,"formatted-value":h[f._uuid],"onUpdate:formattedValue":F=>h[f._uuid]=F},null,40,["formatted-value","onUpdate:formattedValue"])):(v(),L(Z(g(J)(f,a.renders,!1)),{key:2,value:h[f._uuid],"onUpdate:value":F=>h[f._uuid]=F},null,40,["value","onUpdate:value"]))]),_:2},1032,["span","show-label","label-placement","label-align","label-width"])):ee("",!0)],64))),128))]),_:2},1032,["x-gap","y-gap","cols","style"])])],2))),256))]),X("div",Qe,[G(g(se),{size:"small",disabled:!g(E),circle:"",onClick:Ge(g(p),["stop"])},{default:C(()=>[U("+")]),_:1},8,["disabled","onClick"])])],64)):(v(),L(g(ye),{key:1,"x-gap":a.gridGap,"y-gap":a.gridGap,cols:a.form.grid,style:$e({width:a.form.width,margin:"0px auto"})},{default:C(()=>[(v(!0),R(B,null,ie(a.form.items,(h,M)=>(v(),R(B,{key:M},[h._hide!=!0?(v(),L(g(ge),{key:0,span:h._col,"show-feedback":!1,"show-label":!(h._hideLabel===!0||!a.form.labelShow),"label-placement":a.form.labelPlacement,"label-align":a.form.labelAlign,"label-width":a.form.labelWidth},{label:C(()=>[U(Q(h._text),1),h._required?(v(),R("span",xe," *")):ee("",!0)]),default:C(()=>[h._container&&h.items?(v(),L(Z(g(J)(h,a.renders,!1)),{key:0},{default:C(()=>[G(m,{gridGap:a.gridGap,renders:a.renders,form:h,formData:g($)(h),labelPlacement:h.labelPlacement,labelAlign:h.labelAlign},null,8,["gridGap","renders","form","formData","labelPlacement","labelAlign"])]),_:2},1024)):h._widget=="DATE"?(v(),L(Z(g(J)(h,a.renders,!1)),{key:1,"formatted-value":a.formData[h._uuid],"onUpdate:formattedValue":f=>a.formData[h._uuid]=f},null,40,["formatted-value","onUpdate:formattedValue"])):(v(),L(Z(g(J)(h,a.renders,!1)),{key:2,value:a.formData[h._uuid],"onUpdate:value":f=>a.formData[h._uuid]=f},null,40,["value","onUpdate:value"]))]),_:2},1032,["span","show-label","label-placement","label-align","label-width"])):ee("",!0)],64))),128))]),_:1},8,["x-gap","y-gap","cols","style"]))}}}),et=Le(Xe,[["__scopeId","data-v-c68c0c99"]]),tt={style:{"text-align":"center"}},ot={__name:"Render",props:Ve,emits:He,setup(s,{emit:N}){const O=N,E=s;let{inited:$,formData:p,toSubmit:a,onExtraBtn:w}=Ie(E,O," NaiveUI");return(m,h)=>(v(),R("div",null,[g($)?(v(),L(g(Ae),{key:1,size:m.form.size||"medium","label-width":m.form.labelWidth,"show-label":m.form.labelShow},{default:C(()=>[G(g(Ce),null,{default:C(()=>[G(et,{gridGap:m.gridGap,renders:m.renders,form:m.form,formData:g(p)},null,8,["gridGap","renders","form","formData"]),G(g(Oe),{justify:"center",style:{"margin-top":"12px"}},{default:C(()=>[m.form.submitText?(v(),L(g(se),{key:0,disabled:g(p)._disabled,size:"large",type:"primary",onClick:g(a)},{default:C(()=>[U(Q(m.form.submitText),1)]),_:1},8,["disabled","onClick"])):ee("",!0),(v(!0),R(B,null,ie(m.form.buttons,M=>(v(),L(g(se),{type:M.theme,size:"large",onClick:f=>g(w)(M)},{default:C(()=>[U(Q(M.text),1)]),_:2},1032,["type","onClick"]))),256))]),_:1})]),_:1})]),_:1},8,["size","label-width","show-label"])):Ye(m.$slots,"tip",{key:0},()=>[X("div",tt,[G(g(ke),null,{description:C(()=>[U("表单渲染中...")]),_:1})])])]))}};var ve={exports:{}};(function(s,N){(function(O,E){s.exports=E()})(ze,function(){var O=1e3,E=6e4,$=36e5,p="millisecond",a="second",w="minute",m="hour",h="day",M="week",f="month",V="quarter",F="year",Y="date",te="Invalid Date",oe=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,o=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,c={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(u){var r=["th","st","nd","rd"],e=u%100;return"["+u+(r[(e-20)%10]||r[e]||r[0])+"]"}},i=function(u,r,e){var n=String(u);return!n||n.length>=r?u:""+Array(r+1-n.length).join(e)+u},D={s:i,z:function(u){var r=-u.utcOffset(),e=Math.abs(r),n=Math.floor(e/60),t=e%60;return(r<=0?"+":"-")+i(n,2,"0")+":"+i(t,2,"0")},m:function u(r,e){if(r.date()<e.date())return-u(e,r);var n=12*(e.year()-r.year())+(e.month()-r.month()),t=r.clone().add(n,f),l=e-t<0,d=r.clone().add(n+(l?-1:1),f);return+(-(n+(e-t)/(l?t-d:d-t))||0)},a:function(u){return u<0?Math.ceil(u)||0:Math.floor(u)},p:function(u){return{M:f,y:F,w:M,d:h,D:Y,h:m,m:w,s:a,ms:p,Q:V}[u]||String(u||"").toLowerCase().replace(/s$/,"")},u:function(u){return u===void 0}},H="en",j={};j[H]=c;var ce="$isDayjsObject",ue=function(u){return u instanceof ae||!(!u||!u[ce])},re=function u(r,e,n){var t;if(!r)return H;if(typeof r=="string"){var l=r.toLowerCase();j[l]&&(t=l),e&&(j[l]=e,t=l);var d=r.split("-");if(!t&&d.length>1)return u(d[0])}else{var b=r.name;j[b]=r,t=b}return!n&&t&&(H=t),t||!n&&H},S=function(u,r){if(ue(u))return u.clone();var e=typeof r=="object"?r:{};return e.date=u,e.args=arguments,new ae(e)},y=D;y.l=re,y.i=ue,y.w=function(u,r){return S(u,{locale:r.$L,utc:r.$u,x:r.$x,$offset:r.$offset})};var ae=function(){function u(e){this.$L=re(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[ce]=!0}var r=u.prototype;return r.parse=function(e){this.$d=function(n){var t=n.date,l=n.utc;if(t===null)return new Date(NaN);if(y.u(t))return new Date;if(t instanceof Date)return new Date(t);if(typeof t=="string"&&!/Z$/i.test(t)){var d=t.match(oe);if(d){var b=d[2]-1||0,_=(d[7]||"0").substring(0,3);return l?new Date(Date.UTC(d[1],b,d[3]||1,d[4]||0,d[5]||0,d[6]||0,_)):new Date(d[1],b,d[3]||1,d[4]||0,d[5]||0,d[6]||0,_)}}return new Date(t)}(e),this.init()},r.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},r.$utils=function(){return y},r.isValid=function(){return this.$d.toString()!==te},r.isSame=function(e,n){var t=S(e);return this.startOf(n)<=t&&t<=this.endOf(n)},r.isAfter=function(e,n){return S(e)<this.startOf(n)},r.isBefore=function(e,n){return this.endOf(n)<S(e)},r.$g=function(e,n,t){return y.u(e)?this[n]:this.set(t,e)},r.unix=function(){return Math.floor(this.valueOf()/1e3)},r.valueOf=function(){return this.$d.getTime()},r.startOf=function(e,n){var t=this,l=!!y.u(n)||n,d=y.p(e),b=function(W,P){var z=y.w(t.$u?Date.UTC(t.$y,P,W):new Date(t.$y,P,W),t);return l?z:z.endOf(h)},_=function(W,P){return y.w(t.toDate()[W].apply(t.toDate("s"),(l?[0,0,0,0]:[23,59,59,999]).slice(P)),t)},k=this.$W,A=this.$M,T=this.$D,q="set"+(this.$u?"UTC":"");switch(d){case F:return l?b(1,0):b(31,11);case f:return l?b(1,A):b(0,A+1);case M:var I=this.$locale().weekStart||0,x=(k<I?k+7:k)-I;return b(l?T-x:T+(6-x),A);case h:case Y:return _(q+"Hours",0);case m:return _(q+"Minutes",1);case w:return _(q+"Seconds",2);case a:return _(q+"Milliseconds",3);default:return this.clone()}},r.endOf=function(e){return this.startOf(e,!1)},r.$set=function(e,n){var t,l=y.p(e),d="set"+(this.$u?"UTC":""),b=(t={},t[h]=d+"Date",t[Y]=d+"Date",t[f]=d+"Month",t[F]=d+"FullYear",t[m]=d+"Hours",t[w]=d+"Minutes",t[a]=d+"Seconds",t[p]=d+"Milliseconds",t)[l],_=l===h?this.$D+(n-this.$W):n;if(l===f||l===F){var k=this.clone().set(Y,1);k.$d[b](_),k.init(),this.$d=k.set(Y,Math.min(this.$D,k.daysInMonth())).$d}else b&&this.$d[b](_);return this.init(),this},r.set=function(e,n){return this.clone().$set(e,n)},r.get=function(e){return this[y.p(e)]()},r.add=function(e,n){var t,l=this;e=Number(e);var d=y.p(n),b=function(A){var T=S(l);return y.w(T.date(T.date()+Math.round(A*e)),l)};if(d===f)return this.set(f,this.$M+e);if(d===F)return this.set(F,this.$y+e);if(d===h)return b(1);if(d===M)return b(7);var _=(t={},t[w]=E,t[m]=$,t[a]=O,t)[d]||1,k=this.$d.getTime()+e*_;return y.w(k,this)},r.subtract=function(e,n){return this.add(-1*e,n)},r.format=function(e){var n=this,t=this.$locale();if(!this.isValid())return t.invalidDate||te;var l=e||"YYYY-MM-DDTHH:mm:ssZ",d=y.z(this),b=this.$H,_=this.$m,k=this.$M,A=t.weekdays,T=t.months,q=t.meridiem,I=function(P,z,K,ne){return P&&(P[z]||P(n,l))||K[z].slice(0,ne)},x=function(P){return y.s(b%12||12,P,"0")},W=q||function(P,z,K){var ne=P<12?"AM":"PM";return K?ne.toLowerCase():ne};return l.replace(o,function(P,z){return z||function(K){switch(K){case"YY":return String(n.$y).slice(-2);case"YYYY":return y.s(n.$y,4,"0");case"M":return k+1;case"MM":return y.s(k+1,2,"0");case"MMM":return I(t.monthsShort,k,T,3);case"MMMM":return I(T,k);case"D":return n.$D;case"DD":return y.s(n.$D,2,"0");case"d":return String(n.$W);case"dd":return I(t.weekdaysMin,n.$W,A,2);case"ddd":return I(t.weekdaysShort,n.$W,A,3);case"dddd":return A[n.$W];case"H":return String(b);case"HH":return y.s(b,2,"0");case"h":return x(1);case"hh":return x(2);case"a":return W(b,_,!0);case"A":return W(b,_,!1);case"m":return String(_);case"mm":return y.s(_,2,"0");case"s":return String(n.$s);case"ss":return y.s(n.$s,2,"0");case"SSS":return y.s(n.$ms,3,"0");case"Z":return d}return null}(P)||d.replace(":","")})},r.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},r.diff=function(e,n,t){var l,d=this,b=y.p(n),_=S(e),k=(_.utcOffset()-this.utcOffset())*E,A=this-_,T=function(){return y.m(d,_)};switch(b){case F:l=T()/12;break;case f:l=T();break;case V:l=T()/3;break;case M:l=(A-k)/6048e5;break;case h:l=(A-k)/864e5;break;case m:l=A/$;break;case w:l=A/E;break;case a:l=A/O;break;default:l=A}return t?l:y.a(l)},r.daysInMonth=function(){return this.endOf(f).$D},r.$locale=function(){return j[this.$L]},r.locale=function(e,n){if(!e)return this.$L;var t=this.clone(),l=re(e,n,!0);return l&&(t.$L=l),t},r.clone=function(){return y.w(this.$d,this)},r.toDate=function(){return new Date(this.valueOf())},r.toJSON=function(){return this.isValid()?this.toISOString():null},r.toISOString=function(){return this.$d.toISOString()},r.toString=function(){return this.$d.toUTCString()},u}(),he=ae.prototype;return S.prototype=he,[["$ms",p],["$s",a],["$m",w],["$H",m],["$W",h],["$M",f],["$y",F],["$D",Y]].forEach(function(u){he[u[1]]=function(r){return this.$g(r,u[0],u[1])}}),S.extend=function(u,r){return u.$i||(u(r,ae,S),u.$i=!0),S},S.locale=re,S.isDayjs=ue,S.unix=function(u){return S(1e3*u)},S.en=j[H],S.Ls=j,S.p={},S})})(ve);var rt=ve.exports;const at=Ue(rt);fe["${date}"]=()=>(console.debug("[扩展表单值计算] 获取当前日期（使用 dayjs 库）"),at(new Date).format("YYYY-MM-DD"));fe["${username}"]=()=>"集成显卡";function ut(s={}){let N=de(Ne(s)),O=de({data:{},action:""});return{form:N,onInited:()=>Object.assign(O,{data:"表单渲染完成^.^"}),onFailed:a=>Object.assign(O,{data:a}),onSubmit:(a,w)=>{Object.assign(O,{data:a,action:w})},result:O}}export{We as C,Ve as R,ot as _,Be as a,He as b,Ie as c,at as d,ut as e};
